<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Obstacle Course</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      // Simple teleport component
      AFRAME.registerComponent('simple-teleport', {
        schema: {
          cameraRig: {type: 'selector'},
          button: {default: 'trigger'}
        },
        init: function() {
          this.onButtonDown = this.onButtonDown.bind(this);
          this.el.addEventListener(this.data.button + 'down', this.onButtonDown);
          
          // Create teleport indicator
          this.teleportIndicator = document.createElement('a-ring');
          this.teleportIndicator.setAttribute('color', '#00ff00');
          this.teleportIndicator.setAttribute('radius-inner', '0.2');
          this.teleportIndicator.setAttribute('radius-outer', '0.4');
          this.teleportIndicator.setAttribute('rotation', '-90 0 0');
          this.teleportIndicator.setAttribute('visible', 'false');
          this.el.sceneEl.appendChild(this.teleportIndicator);
          
          // Create laser line
          this.laserLine = document.createElement('a-entity');
          this.laserLine.setAttribute('line', {
            start: '0 0 0',
            end: '0 0 -5',
            color: '#00ff00',
            opacity: 0.6
          });
          this.el.appendChild(this.laserLine);
        },
        tick: function() {
          // Raycast from controller
          var el = this.el;
          var direction = new THREE.Vector3(0, 0, -1);
          direction.applyQuaternion(el.object3D.quaternion);
          
          var raycaster = new THREE.Raycaster();
          raycaster.set(el.object3D.position, direction);
          raycaster.far = 10;
          
          // Get all platforms
          var platforms = Array.from(document.querySelectorAll('.collidable')).map(e => e.object3D);
          var intersects = raycaster.intersectObjects(platforms, true);
          
          if (intersects.length > 0) {
            var point = intersects[0].point;
            this.teleportIndicator.setAttribute('visible', 'true');
            this.teleportIndicator.setAttribute('position', point);
            this.targetPosition = point;
            
            // Update laser line
            var localEnd = el.object3D.worldToLocal(point.clone());
            this.laserLine.setAttribute('line', 'end', localEnd);
          } else {
            this.teleportIndicator.setAttribute('visible', 'false');
            this.laserLine.setAttribute('line', 'end', '0 0 -5');
            this.targetPosition = null;
          }
        },
        onButtonDown: function() {
          if (this.targetPosition) {
            var rig = this.data.cameraRig || this.el.sceneEl.camera.el.parentEl;
            var offset = this.targetPosition.clone();
            offset.y += 0.1; // Slight offset above ground
            rig.setAttribute('position', offset);
          }
        }
      });
    </script>   
  </head>
  <body>
    <a-scene>
      <!-- Environment -->
      <a-sky color="#87CEEB"></a-sky>
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity
        light="type: directional; intensity: 0.8"
        position="2 4 1"
      ></a-entity>

      <!-- Ground -->
      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        color="#90EE90"
      ></a-plane>

      <!-- Starting platform -->
      <a-box
        position="0 0.1 -3"
        width="3"
        height="0.2"
        depth="3"
        color="#8B4513"
      ></a-box>
      <a-text
        value="START"
        position="0 1.5 -3"
        align="center"
        color="#FFFFFF"
        width="4"
      ></a-text>

      <!-- Platform 1 - straight ahead -->
      <a-box
        position="0 0.1 -8"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#FF6347"
      ></a-box>

      <!-- Platform 2 - to the right -->
      <a-box
        position="4 0.5 -12"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#4169E1"
      ></a-box>

      <!-- Platform 3 - elevated -->
      <a-box
        position="1 1.2 -16"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#FFD700"
      ></a-box>

      <!-- Platform 4 - back to left -->
      <a-box
        position="-3 1.5 -20"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#9370DB"
      ></a-box>

      <!-- Platform 5 - forward -->
      <a-box
        position="-3 1.8 -25"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#FF69B4"
      ></a-box>

      <!-- Final platform -->
      <a-box
        position="0 2.2 -30"
        width="4"
        height="0.2"
        depth="4"
        color="#32CD32"
      ></a-box>
      <a-text
        value="FINISH!"
        position="0 3.5 -30"
        align="center"
        color="#FFFFFF"
        width="6"
      ></a-text>

      <!-- Obstacles - walls to navigate around -->
      <a-box
        position="-2 1 -10"
        width="0.3"
        height="2"
        depth="4"
        color="#696969"
      ></a-box>
      <a-box
        position="2.5 1.5 -14"
        width="0.3"
        height="2"
        depth="3"
        color="#696969"
      ></a-box>
      <a-box
        position="-1 2 -22.5"
        width="3"
        height="2"
        depth="0.3"
        color="#696969"
      ></a-box>

      <!-- Decorative elements -->
      <a-cylinder
        position="5 0.5 -15"
        radius="0.3"
        height="1"
        color="#8B4513"
      ></a-cylinder>
      <a-sphere position="5 1.3 -15" radius="0.8" color="#228B22"></a-sphere>

      <a-cylinder
        position="-5 0.5 -18"
        radius="0.3"
        height="1"
        color="#8B4513"
      ></a-cylinder>
      <a-sphere position="-5 1.3 -18" radius="0.8" color="#228B22"></a-sphere>

      <!-- Camera rig with controllers -->
      <a-entity id="cameraRig" movement-controls="fly: false; speed: 0.15">
        <a-entity
          id="head"
          camera
          position="0 1.6 0"
          look-controls="pointerLockEnabled: false"
        >
        </a-entity>

        <!-- Left Controller with Teleportation -->
        <a-entity
          id="leftHand"
          hand-controls="hand: left; handModelStyle: toon; color: #15ACCF"
          teleport-controls="cameraRig: #cameraRig; teleportOrigin: #head; button: trigger; curveShootingSpeed: 10; type: parabolic; landingMaxAngle: 60; collisionEntities: a-box, a-plane"
          visible="true"
        ></a-entity>

        <!-- Right Controller with Laser -->
        <a-entity
          id="rightHand"
          hand-controls="hand: right; handModelStyle: toon; color: #15ACCF"
          laser-controls="hand: right"
          raycaster="objects: a-box, a-plane; far: 10"
          visible="true"
        ></a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
