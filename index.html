<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-t" />
    <title>VR Obstacle Course</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
    <script>
      AFRAME.registerComponent("audio-handler", {
        init: function () {
          this.teleportSound = document.querySelector("#teleport-sound");
          this.finishSound = document.querySelector("#finish-sound");
          this.finishPlatform = document.querySelector("#final-platform");

          this.el.addEventListener("teleported", (e) => {
            this.teleportSound.components.sound.playSound();

            if (e.detail.landingTarget && e.detail.landingTarget.id === 'final-platform') {
              this.finishSound.components.sound.playSound();
            }
          });
        },
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <audio
          id="teleport-wav"
          src="./media/teleport.wav"
          preload="auto"
        ></audio>
        <audio id="yay-wav" src="./media/yay.wav" preload="auto"></audio>
      </a-assets>

      <!-- environment -->
      <a-sky color="#87CEEB"></a-sky>
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity
        light="type: directional; intensity: 0.8"
        position="2 4 1"
      ></a-entity>

      <!-- ground -->
      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        color="#90EE90"
      ></a-plane>

      <!-- start -->
      <a-box
        class="teleport-platform"
        position="0 0.1 -3"
        width="3"
        height="0.2"
        depth="3"
        color="#8B4513"
      ></a-box>
      <a-text
        value="START"
        position="0 1.5 -3"
        align="center"
        color="#FFFFFF"
        width="4"
      ></a-text>

      <!-- Platform 1 -->
      <a-box
        class="teleport-platform"
        position="0 0.1 -8"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#FF6347"
      ></a-box>

      <!-- Platform 2 -->
      <a-box
        class="teleport-platform"
        position="4 0.5 -12"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#4169E1"
      ></a-box>

      <!-- Platform 3 -->
      <a-box
        class="teleport-platform"
        position="1 1.2 -16"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#FFD700"
      ></a-box>

      <!-- Platform 4 -->
      <a-box
        class="teleport-platform"
        position="-3 1.5 -20"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#9370DB"
      ></a-box>

      <!-- Platform 5 -->
      <a-box
        class="teleport-platform"
        position="-3 1.8 -25"
        width="2.5"
        height="0.2"
        depth="2.5"
        color="#FF69B4"
      ></a-box>

      <!-- Final platform -->
      <a-box
        id="final-platform"
        class="teleport-platform"
        position="0 2.2 -30"
        width="4"
        height="0.2"
        depth="4"
        color="#32CD32"
      ></a-box>
      <a-text
        value="FINISH!"
        position="0 3.5 -30"
        align="center"
        color="#FFFFFF"
        width="6"
      ></a-text>

      <!-- walls -->
      <a-box
        position="-2 1 -10"
        width="0.3"
        height="2"
        depth="4"
        color="#696969"
      ></a-box>
      <a-box
        position="2.5 1.5 -14"
        width="0.3"
        height="2"
        depth="3"
        color="#696969"
      ></a-box>
      <a-box
        position="-1 2 -22.5"
        width="3"
        height="2"
        depth="0.3"
        color="#696969"
      ></a-box>

      <a-entity id="cameraRig" movement-controls="speed: 0">
        <a-entity
          id="head"
          camera
          position="0 1.6 0"
          look-controls="pointerLockEnabled: false"
        >
          <a-entity id="teleport-sound" sound="src: #teleport-wav;"></a-entity>
          <a-entity id="finish-sound" sound="src: #yay-wav;"></a-entity>
        </a-entity>

        <a-entity
          id="leftHand"
          hand-controls="hand: left; handModelStyle: toon; color: #15ACCF"
          oculus-touch-controls="hand: left"
          blink-controls="cameraRig: #cameraRig; teleportOrigin: #head; button: trigger; curveShootingSpeed: 10; collisionEntities: .teleport-platform; landingMaxAngle: 60"
          audio-handler
        >
        </a-entity>

        <a-entity
          id="rightHand"
          hand-controls="hand: right; handModelStyle: toon; color: #15ACCF"
          oculus-touch-controls="hand: right"
          blink-controls="cameraRig: #cameraRig; teleportOrigin: #head; button: trigger; curveShootingSpeed: 10; collisionEntities: .teleport-platform; landingMaxAngle: 60"
          audio-handler
        >
        </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
